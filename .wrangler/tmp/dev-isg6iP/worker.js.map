{
  "version": 3,
  "sources": ["../../../app/worker.ts", "../../../../../Users/ishaw/AppData/Local/npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../Users/ishaw/AppData/Local/npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-1IxSH4/middleware-insertion-facade.js", "../../../../../Users/ishaw/AppData/Local/npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts", "../bundle-1IxSH4/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\dev\\Push\\.wrangler\\tmp\\dev-isg6iP",
  "sourcesContent": ["/**\r\n * Cloudflare Worker \u2014 serves the Vite app + streaming proxy to Kimi For Coding.\r\n *\r\n * Static assets in ./dist are served directly by the [assets] layer.\r\n * Only unmatched requests (like /api/kimi/chat) reach this Worker.\r\n */\r\n\r\ninterface Env {\r\n  MOONSHOT_API_KEY?: string;\r\n  OLLAMA_API_KEY?: string;\r\n  MISTRAL_API_KEY?: string;\r\n  MODAL_SANDBOX_BASE_URL?: string;\r\n  BROWSERBASE_API_KEY?: string;\r\n  BROWSERBASE_PROJECT_ID?: string;\r\n  ALLOWED_ORIGINS?: string;\r\n  ASSETS: Fetcher;\r\n  // GitHub App credentials\r\n  GITHUB_APP_ID?: string;\r\n  GITHUB_APP_PRIVATE_KEY?: string;\r\n  GITHUB_ALLOWED_INSTALLATION_IDS?: string;\r\n  // GitHub App OAuth (for auto-connect flow)\r\n  GITHUB_APP_CLIENT_ID?: string;\r\n  GITHUB_APP_CLIENT_SECRET?: string;\r\n}\r\n\r\nconst MAX_BODY_SIZE_BYTES = 512 * 1024; // 512KB \u2014 supports file uploads via sandbox write\r\nconst RATE_LIMIT_WINDOW_MS = 60_000;\r\nconst RATE_LIMIT_MAX = 30;\r\nconst rateLimitStore = new Map<string, { count: number; windowStart: number }>();\r\n\r\n// Sandbox endpoint name mapping: /api/sandbox/{route} \u2192 Modal function name\r\nconst SANDBOX_ROUTES: Record<string, string> = {\r\n  create: 'create',\r\n  exec: 'exec-command',\r\n  read: 'file-ops',\r\n  write: 'file-ops',\r\n  diff: 'get-diff',\r\n  cleanup: 'cleanup',\r\n  list: 'file-ops',\r\n  delete: 'file-ops',\r\n  'browser-screenshot': 'browser-screenshot',\r\n};\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    const url = new URL(request.url);\r\n\r\n    // API route: health check endpoint\r\n    if (url.pathname === '/api/health' && request.method === 'GET') {\r\n      return handleHealthCheck(env);\r\n    }\r\n\r\n    // API route: GitHub App token exchange\r\n    if (url.pathname === '/api/github/app-token' && request.method === 'POST') {\r\n      return handleGitHubAppToken(request, env);\r\n    }\r\n\r\n    // API route: GitHub App OAuth auto-connect (code \u2192 user token \u2192 find installation \u2192 installation token)\r\n    if (url.pathname === '/api/github/app-oauth' && request.method === 'POST') {\r\n      return handleGitHubAppOAuth(request, env);\r\n    }\r\n\r\n    // API route: streaming proxy to Kimi For Coding (SSE)\r\n    if (url.pathname === '/api/kimi/chat' && request.method === 'POST') {\r\n      return handleKimiChat(request, env);\r\n    }\r\n\r\n    // API route: streaming proxy to Ollama Cloud (SSE, OpenAI-compatible)\r\n    if (url.pathname === '/api/ollama/chat' && request.method === 'POST') {\r\n      return handleOllamaChat(request, env);\r\n    }\r\n\r\n    // API route: streaming proxy to Mistral Vibe (SSE, OpenAI-compatible)\r\n    if (url.pathname === '/api/mistral/chat' && request.method === 'POST') {\r\n      return handleMistralChat(request, env);\r\n    }\r\n\r\n    // API route: sandbox proxy to Modal\r\n    if (url.pathname.startsWith('/api/sandbox/') && request.method === 'POST') {\r\n      const route = url.pathname.replace('/api/sandbox/', '');\r\n      return handleSandbox(request, env, url, route);\r\n    }\r\n\r\n    // SPA fallback: serve index.html for non-file paths\r\n    // (actual static files like .js/.css are already served by the [assets] layer)\r\n    return env.ASSETS.fetch(new Request(new URL('/index.html', request.url)));\r\n  },\r\n};\r\n\r\nfunction normalizeOrigin(value: string | null): string | null {\r\n  if (!value || value === 'null') return null;\r\n  try {\r\n    return new URL(value).origin;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction getAllowedOrigins(requestUrl: URL, env: Env): Set<string> {\r\n  const allowed = new Set<string>([requestUrl.origin]);\r\n  const raw = env.ALLOWED_ORIGINS;\r\n  if (raw) {\r\n    for (const entry of raw.split(',')) {\r\n      const normalized = normalizeOrigin(entry.trim());\r\n      if (normalized) {\r\n        allowed.add(normalized);\r\n      }\r\n    }\r\n  }\r\n  return allowed;\r\n}\r\n\r\nfunction validateOrigin(request: Request, requestUrl: URL, env: Env): { ok: boolean; error?: string } {\r\n  const origin = normalizeOrigin(request.headers.get('Origin'));\r\n  const refererOrigin = normalizeOrigin(request.headers.get('Referer'));\r\n  const candidates = [origin, refererOrigin].filter(Boolean) as string[];\r\n\r\n  if (candidates.length === 0) {\r\n    return { ok: false, error: 'Missing or invalid Origin/Referer' };\r\n  }\r\n\r\n  const allowedOrigins = getAllowedOrigins(requestUrl, env);\r\n  const allowed = candidates.some((candidate) => allowedOrigins.has(candidate));\r\n  if (!allowed) {\r\n    return { ok: false, error: 'Origin not allowed' };\r\n  }\r\n\r\n  return { ok: true };\r\n}\r\n\r\nfunction getClientIp(request: Request): string {\r\n  const cfIp = request.headers.get('CF-Connecting-IP');\r\n  if (cfIp) return cfIp;\r\n  const xff = request.headers.get('X-Forwarded-For');\r\n  if (xff) return xff.split(',')[0].trim();\r\n  return 'unknown';\r\n}\r\n\r\nfunction cleanupRateLimitStore(now: number) {\r\n  if (rateLimitStore.size < 1000) return;\r\n  for (const [ip, entry] of rateLimitStore.entries()) {\r\n    if (now - entry.windowStart >= RATE_LIMIT_WINDOW_MS) {\r\n      rateLimitStore.delete(ip);\r\n    }\r\n  }\r\n}\r\n\r\nfunction checkRateLimit(ip: string, now: number): { allowed: boolean; retryAfter: number } {\r\n  const entry = rateLimitStore.get(ip);\r\n\r\n  if (!entry || now - entry.windowStart >= RATE_LIMIT_WINDOW_MS) {\r\n    rateLimitStore.set(ip, { count: 1, windowStart: now });\r\n    return { allowed: true, retryAfter: 0 };\r\n  }\r\n\r\n  if (entry.count >= RATE_LIMIT_MAX) {\r\n    const retryAfter = Math.ceil((RATE_LIMIT_WINDOW_MS - (now - entry.windowStart)) / 1000);\r\n    return { allowed: false, retryAfter };\r\n  }\r\n\r\n  entry.count += 1;\r\n  return { allowed: true, retryAfter: 0 };\r\n}\r\n\r\nasync function readBodyText(\r\n  request: Request,\r\n  maxBytes: number,\r\n): Promise<{ ok: true; text: string } | { ok: false; status: number; error: string }> {\r\n  const lengthHeader = request.headers.get('Content-Length');\r\n  if (lengthHeader) {\r\n    const length = Number(lengthHeader);\r\n    if (Number.isFinite(length) && length > maxBytes) {\r\n      return { ok: false, status: 413, error: 'Request body too large' };\r\n    }\r\n  }\r\n\r\n  if (!request.body) {\r\n    return { ok: false, status: 400, error: 'Missing request body' };\r\n  }\r\n\r\n  const reader = request.body.getReader();\r\n  const chunks: Uint8Array[] = [];\r\n  let received = 0;\r\n\r\n  while (true) {\r\n    const { done, value } = await reader.read();\r\n    if (done) break;\r\n    if (!value) continue;\r\n    received += value.byteLength;\r\n    if (received > maxBytes) {\r\n      return { ok: false, status: 413, error: 'Request body too large' };\r\n    }\r\n    chunks.push(value);\r\n  }\r\n\r\n  if (received === 0) {\r\n    return { ok: false, status: 400, error: 'Empty request body' };\r\n  }\r\n\r\n  const merged = new Uint8Array(received);\r\n  let offset = 0;\r\n  for (const chunk of chunks) {\r\n    merged.set(chunk, offset);\r\n    offset += chunk.byteLength;\r\n  }\r\n\r\n  return { ok: true, text: new TextDecoder().decode(merged) };\r\n}\r\n\r\nasync function handleSandbox(request: Request, env: Env, requestUrl: URL, route: string): Promise<Response> {\r\n  const modalFunction = SANDBOX_ROUTES[route];\r\n  if (!modalFunction) {\r\n    return Response.json({ error: `Unknown sandbox route: ${route}` }, { status: 404 });\r\n  }\r\n\r\n  const baseUrl = env.MODAL_SANDBOX_BASE_URL;\r\n  if (!baseUrl) {\r\n    return Response.json({\r\n      error: 'Sandbox not configured',\r\n      code: 'MODAL_NOT_CONFIGURED',\r\n      details: 'MODAL_SANDBOX_BASE_URL secret is not set. Run: npx wrangler secret put MODAL_SANDBOX_BASE_URL',\r\n    }, { status: 503 });\r\n  }\r\n\r\n  // Validate URL format to catch common configuration mistakes\r\n  if (!baseUrl.startsWith('https://') || !baseUrl.includes('--')) {\r\n    return Response.json({\r\n      error: 'Sandbox misconfigured',\r\n      code: 'MODAL_URL_INVALID',\r\n      details: `MODAL_SANDBOX_BASE_URL must be https://<username>--push-sandbox (got: ${baseUrl.slice(0, 50)}...)`,\r\n    }, { status: 503 });\r\n  }\r\n\r\n  if (baseUrl.endsWith('/')) {\r\n    return Response.json({\r\n      error: 'Sandbox misconfigured',\r\n      code: 'MODAL_URL_TRAILING_SLASH',\r\n      details: 'MODAL_SANDBOX_BASE_URL must not have a trailing slash. Remove the trailing / and redeploy.',\r\n    }, { status: 503 });\r\n  }\r\n\r\n  // Validate origin\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  // Rate limit\r\n  const now = Date.now();\r\n  cleanupRateLimitStore(now);\r\n  const rateLimit = checkRateLimit(getClientIp(request), now);\r\n  if (!rateLimit.allowed) {\r\n    return Response.json(\r\n      { error: 'Rate limit exceeded. Try again later.' },\r\n      { status: 429, headers: { 'Retry-After': String(rateLimit.retryAfter) } },\r\n    );\r\n  }\r\n\r\n  // Read and forward body\r\n  const bodyResult = await readBodyText(request, MAX_BODY_SIZE_BYTES);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  // Route-specific payload enrichment without changing client contracts.\r\n  let forwardBodyText = bodyResult.text;\r\n  if (route === 'read' || route === 'write' || route === 'list' || route === 'delete' || route === 'browser-screenshot') {\r\n    try {\r\n      const payload = JSON.parse(bodyResult.text) as Record<string, unknown>;\r\n\r\n      if (route === 'read') payload.action = 'read';\r\n      if (route === 'write') payload.action = 'write';\r\n      if (route === 'list') payload.action = 'list';\r\n      if (route === 'delete') payload.action = 'delete';\r\n\r\n      if (route === 'browser-screenshot') {\r\n        payload.browserbase_api_key = env.BROWSERBASE_API_KEY || '';\r\n        payload.browserbase_project_id = env.BROWSERBASE_PROJECT_ID || '';\r\n      }\r\n\r\n      forwardBodyText = JSON.stringify(payload);\r\n    } catch {\r\n      return Response.json({ error: 'Invalid JSON body' }, { status: 400 });\r\n    }\r\n  }\r\n\r\n  // Forward to Modal web endpoint\r\n  // Modal web endpoints follow pattern: {base}-{function_name}.modal.run\r\n  const modalUrl = `${baseUrl}-${modalFunction}.modal.run`;\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 60_000);\r\n    let upstream: Response;\r\n\r\n    try {\r\n      upstream = await fetch(modalUrl, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: forwardBodyText,\r\n        signal: controller.signal,\r\n      });\r\n    } finally {\r\n      clearTimeout(timeoutId);\r\n    }\r\n\r\n    if (!upstream.ok) {\r\n      const errBody = await upstream.text().catch(() => '');\r\n      console.error(`[api/sandbox/${route}] Modal ${upstream.status}: ${errBody.slice(0, 500)}`);\r\n\r\n      // Provide actionable error messages based on status code\r\n      let code = 'MODAL_ERROR';\r\n      let details = errBody.slice(0, 200);\r\n\r\n      if (upstream.status === 404) {\r\n        code = 'MODAL_NOT_FOUND';\r\n        details = `Modal endpoint not found. The app may not be deployed. Run: cd sandbox && modal deploy app.py`;\r\n      } else if (upstream.status === 401 || upstream.status === 403) {\r\n        code = 'MODAL_AUTH_FAILED';\r\n        details = 'Modal authentication failed. Check that your Modal tokens are valid and the app is deployed under the correct account.';\r\n      } else if (upstream.status === 502 || upstream.status === 503) {\r\n        code = 'MODAL_UNAVAILABLE';\r\n        details = 'Modal is temporarily unavailable. The container may be cold-starting. Try again in a few seconds.';\r\n      } else if (upstream.status === 504) {\r\n        code = 'MODAL_TIMEOUT';\r\n        details = 'Modal request timed out. The operation took too long to complete.';\r\n      }\r\n\r\n      return Response.json(\r\n        { error: `Sandbox error (${upstream.status})`, code, details },\r\n        { status: upstream.status },\r\n      );\r\n    }\r\n\r\n    const data: unknown = await upstream.json();\r\n    return Response.json(data);\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : String(err);\r\n    const isTimeout = err instanceof Error && err.name === 'AbortError';\r\n    console.error(`[api/sandbox/${route}] Error: ${message}`);\r\n\r\n    if (isTimeout) {\r\n      return Response.json({\r\n        error: 'Sandbox request timed out',\r\n        code: 'MODAL_TIMEOUT',\r\n        details: 'The sandbox took longer than 60 seconds to respond. Try a simpler operation or check Modal dashboard for issues.',\r\n      }, { status: 504 });\r\n    }\r\n\r\n    // Check for common network errors\r\n    const isNetworkError = message.includes('fetch failed') || message.includes('ECONNREFUSED') || message.includes('network');\r\n    if (isNetworkError) {\r\n      return Response.json({\r\n        error: 'Cannot reach Modal',\r\n        code: 'MODAL_NETWORK_ERROR',\r\n        details: `Network error connecting to Modal. Check that the MODAL_SANDBOX_BASE_URL is correct and Modal is not experiencing outages. (${message})`,\r\n      }, { status: 502 });\r\n    }\r\n\r\n    return Response.json({\r\n      error: 'Sandbox error',\r\n      code: 'MODAL_UNKNOWN_ERROR',\r\n      details: message,\r\n    }, { status: 500 });\r\n  }\r\n}\r\n\r\n// --- Health check endpoint ---\r\n\r\ninterface HealthStatus {\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  timestamp: string;\r\n  services: {\r\n    worker: { status: 'ok' };\r\n    kimi: { status: 'ok' | 'unconfigured'; configured: boolean };\r\n    ollama: { status: 'ok' | 'unconfigured'; configured: boolean };\r\n    mistral: { status: 'ok' | 'unconfigured'; configured: boolean };\r\n    sandbox: { status: 'ok' | 'unconfigured' | 'misconfigured'; configured: boolean; error?: string };\r\n    github_app: { status: 'ok' | 'unconfigured'; configured: boolean };\r\n    github_app_oauth: { status: 'ok' | 'unconfigured'; configured: boolean };\r\n  };\r\n  version: string;\r\n}\r\n\r\nasync function handleHealthCheck(env: Env): Promise<Response> {\r\n  const kimiConfigured = Boolean(env.MOONSHOT_API_KEY);\r\n  const ollamaConfigured = Boolean(env.OLLAMA_API_KEY);\r\n  const mistralConfigured = Boolean(env.MISTRAL_API_KEY);\r\n  const sandboxUrl = env.MODAL_SANDBOX_BASE_URL;\r\n\r\n  let sandboxStatus: 'ok' | 'unconfigured' | 'misconfigured' = 'unconfigured';\r\n  let sandboxError: string | undefined;\r\n\r\n  if (sandboxUrl) {\r\n    if (!sandboxUrl.startsWith('https://') || !sandboxUrl.includes('--')) {\r\n      sandboxStatus = 'misconfigured';\r\n      sandboxError = 'MODAL_SANDBOX_BASE_URL format is invalid';\r\n    } else if (sandboxUrl.endsWith('/')) {\r\n      sandboxStatus = 'misconfigured';\r\n      sandboxError = 'MODAL_SANDBOX_BASE_URL has trailing slash';\r\n    } else {\r\n      sandboxStatus = 'ok';\r\n    }\r\n  }\r\n\r\n  const hasAnyLlm = kimiConfigured || ollamaConfigured || mistralConfigured;\r\n  const overallStatus: 'healthy' | 'degraded' | 'unhealthy' =\r\n    hasAnyLlm && sandboxStatus === 'ok' ? 'healthy' :\r\n    hasAnyLlm || sandboxStatus === 'ok' ? 'degraded' : 'unhealthy';\r\n\r\n  const health: HealthStatus = {\r\n    status: overallStatus,\r\n    timestamp: new Date().toISOString(),\r\n    services: {\r\n      worker: { status: 'ok' },\r\n      kimi: { status: kimiConfigured ? 'ok' : 'unconfigured', configured: kimiConfigured },\r\n      ollama: { status: ollamaConfigured ? 'ok' : 'unconfigured', configured: ollamaConfigured },\r\n      mistral: { status: mistralConfigured ? 'ok' : 'unconfigured', configured: mistralConfigured },\r\n      sandbox: { status: sandboxStatus, configured: Boolean(sandboxUrl), error: sandboxError },\r\n      github_app: { status: env.GITHUB_APP_ID && env.GITHUB_APP_PRIVATE_KEY ? 'ok' : 'unconfigured', configured: Boolean(env.GITHUB_APP_ID && env.GITHUB_APP_PRIVATE_KEY) },\r\n      github_app_oauth: { status: env.GITHUB_APP_CLIENT_ID && env.GITHUB_APP_CLIENT_SECRET ? 'ok' : 'unconfigured', configured: Boolean(env.GITHUB_APP_CLIENT_ID && env.GITHUB_APP_CLIENT_SECRET) },\r\n    },\r\n    version: '1.0.0',\r\n  };\r\n\r\n  return Response.json(health, {\r\n    status: overallStatus === 'unhealthy' ? 503 : 200,\r\n    headers: { 'Cache-Control': 'no-store' },\r\n  });\r\n}\r\n\r\nasync function handleKimiChat(request: Request, env: Env): Promise<Response> {\r\n  const requestUrl = new URL(request.url);\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  const now = Date.now();\r\n  cleanupRateLimitStore(now);\r\n  const rateLimit = checkRateLimit(getClientIp(request), now);\r\n  if (!rateLimit.allowed) {\r\n    return Response.json(\r\n      { error: 'Rate limit exceeded. Try again later.' },\r\n      { status: 429, headers: { 'Retry-After': String(rateLimit.retryAfter) } },\r\n    );\r\n  }\r\n\r\n  // Prefer server-side secret; fall back to client-provided Authorization header\r\n  const serverKey = env.MOONSHOT_API_KEY;\r\n  const clientAuth = request.headers.get('Authorization');\r\n  const authHeader = serverKey ? `Bearer ${serverKey}` : clientAuth;\r\n\r\n  if (!authHeader) {\r\n    return Response.json(\r\n      { error: 'Kimi API key not configured. Add it in Settings or set MOONSHOT_API_KEY on the Worker.' },\r\n      { status: 401 },\r\n    );\r\n  }\r\n\r\n  const bodyResult = await readBodyText(request, MAX_BODY_SIZE_BYTES);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  console.log(`[api/kimi/chat] Forwarding request (${bodyResult.text.length} bytes)`);\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 120_000); // 2 min for long responses\r\n    let upstream: Response;\r\n\r\n    try {\r\n      upstream = await fetch('https://api.kimi.com/coding/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': authHeader,\r\n          'User-Agent': 'claude-code/1.0.0',\r\n        },\r\n        body: bodyResult.text,\r\n        signal: controller.signal,\r\n      });\r\n    } finally {\r\n      clearTimeout(timeoutId);\r\n    }\r\n\r\n    console.log(`[api/kimi/chat] Upstream responded: ${upstream.status}`);\r\n\r\n    if (!upstream.ok) {\r\n      const errBody = await upstream.text().catch(() => '');\r\n      console.error(`[api/kimi/chat] Upstream ${upstream.status}: ${errBody.slice(0, 500)}`);\r\n      return Response.json(\r\n        { error: `Kimi API error ${upstream.status}: ${errBody.slice(0, 200)}` },\r\n        { status: upstream.status },\r\n      );\r\n    }\r\n\r\n    // SSE streaming: pipe upstream body straight through\r\n    if (upstream.body) {\r\n      return new Response(upstream.body, {\r\n        status: 200,\r\n        headers: {\r\n          'Content-Type': 'text/event-stream',\r\n          'Cache-Control': 'no-cache',\r\n          'Connection': 'keep-alive',\r\n        },\r\n      });\r\n    }\r\n\r\n    // Non-streaming fallback\r\n    const data: unknown = await upstream.json();\r\n    return Response.json(data);\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : String(err);\r\n    const isTimeout = err instanceof Error && err.name === 'AbortError';\r\n    const status = isTimeout ? 504 : 500;\r\n    const error = isTimeout ? 'Kimi request timed out after 120 seconds' : message;\r\n    console.error(`[api/kimi/chat] Unhandled: ${message}`);\r\n    return Response.json({ error }, { status });\r\n  }\r\n}\r\n\r\n// --- Ollama Cloud streaming proxy ---\r\n\r\nasync function handleOllamaChat(request: Request, env: Env): Promise<Response> {\r\n  const requestUrl = new URL(request.url);\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  const now = Date.now();\r\n  cleanupRateLimitStore(now);\r\n  const rateLimit = checkRateLimit(getClientIp(request), now);\r\n  if (!rateLimit.allowed) {\r\n    return Response.json(\r\n      { error: 'Rate limit exceeded. Try again later.' },\r\n      { status: 429, headers: { 'Retry-After': String(rateLimit.retryAfter) } },\r\n    );\r\n  }\r\n\r\n  // Prefer server-side secret; fall back to client-provided Authorization header\r\n  const serverKey = env.OLLAMA_API_KEY;\r\n  const clientAuth = request.headers.get('Authorization');\r\n  const authHeader = serverKey ? `Bearer ${serverKey}` : clientAuth;\r\n\r\n  if (!authHeader) {\r\n    return Response.json(\r\n      { error: 'Ollama Cloud API key not configured. Add it in Settings or set OLLAMA_API_KEY on the Worker.' },\r\n      { status: 401 },\r\n    );\r\n  }\r\n\r\n  const bodyResult = await readBodyText(request, MAX_BODY_SIZE_BYTES);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  console.log(`[api/ollama/chat] Forwarding request (${bodyResult.text.length} bytes)`);\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 180_000); // 3 min \u2014 Ollama Cloud can be slower\r\n    let upstream: Response;\r\n\r\n    try {\r\n      upstream = await fetch('https://ollama.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': authHeader,\r\n        },\r\n        body: bodyResult.text,\r\n        signal: controller.signal,\r\n      });\r\n    } finally {\r\n      clearTimeout(timeoutId);\r\n    }\r\n\r\n    console.log(`[api/ollama/chat] Upstream responded: ${upstream.status}`);\r\n\r\n    if (!upstream.ok) {\r\n      const errBody = await upstream.text().catch(() => '');\r\n      console.error(`[api/ollama/chat] Upstream ${upstream.status}: ${errBody.slice(0, 500)}`);\r\n      return Response.json(\r\n        { error: `Ollama Cloud API error ${upstream.status}: ${errBody.slice(0, 200)}` },\r\n        { status: upstream.status },\r\n      );\r\n    }\r\n\r\n    // SSE streaming: pipe upstream body straight through\r\n    if (upstream.body) {\r\n      return new Response(upstream.body, {\r\n        status: 200,\r\n        headers: {\r\n          'Content-Type': 'text/event-stream',\r\n          'Cache-Control': 'no-cache',\r\n          'Connection': 'keep-alive',\r\n        },\r\n      });\r\n    }\r\n\r\n    // Non-streaming fallback\r\n    const data: unknown = await upstream.json();\r\n    return Response.json(data);\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : String(err);\r\n    const isTimeout = err instanceof Error && err.name === 'AbortError';\r\n    const status = isTimeout ? 504 : 500;\r\n    const error = isTimeout ? 'Ollama Cloud request timed out after 180 seconds' : message;\r\n    console.error(`[api/ollama/chat] Unhandled: ${message}`);\r\n    return Response.json({ error }, { status });\r\n  }\r\n}\r\n\r\n// --- Mistral Vibe streaming proxy ---\r\n\r\nasync function handleMistralChat(request: Request, env: Env): Promise<Response> {\r\n  const requestUrl = new URL(request.url);\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  const now = Date.now();\r\n  cleanupRateLimitStore(now);\r\n  const rateLimit = checkRateLimit(getClientIp(request), now);\r\n  if (!rateLimit.allowed) {\r\n    return Response.json(\r\n      { error: 'Rate limit exceeded. Try again later.' },\r\n      { status: 429, headers: { 'Retry-After': String(rateLimit.retryAfter) } },\r\n    );\r\n  }\r\n\r\n  // Prefer server-side secret; fall back to client-provided Authorization header\r\n  const serverKey = env.MISTRAL_API_KEY;\r\n  const clientAuth = request.headers.get('Authorization');\r\n  const authHeader = serverKey ? `Bearer ${serverKey}` : clientAuth;\r\n\r\n  if (!authHeader) {\r\n    return Response.json(\r\n      { error: 'Mistral API key not configured. Add it in Settings or set MISTRAL_API_KEY on the Worker.' },\r\n      { status: 401 },\r\n    );\r\n  }\r\n\r\n  const bodyResult = await readBodyText(request, MAX_BODY_SIZE_BYTES);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  console.log(`[api/mistral/chat] Forwarding request (${bodyResult.text.length} bytes)`);\r\n\r\n  try {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 120_000); // 2 min\r\n    let upstream: Response;\r\n\r\n    try {\r\n      upstream = await fetch('https://api.mistral.ai/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': authHeader,\r\n        },\r\n        body: bodyResult.text,\r\n        signal: controller.signal,\r\n      });\r\n    } finally {\r\n      clearTimeout(timeoutId);\r\n    }\r\n\r\n    console.log(`[api/mistral/chat] Upstream responded: ${upstream.status}`);\r\n\r\n    if (!upstream.ok) {\r\n      const errBody = await upstream.text().catch(() => '');\r\n      console.error(`[api/mistral/chat] Upstream ${upstream.status}: ${errBody.slice(0, 500)}`);\r\n      return Response.json(\r\n        { error: `Mistral API error ${upstream.status}: ${errBody.slice(0, 200)}` },\r\n        { status: upstream.status },\r\n      );\r\n    }\r\n\r\n    // SSE streaming: pipe upstream body straight through\r\n    if (upstream.body) {\r\n      return new Response(upstream.body, {\r\n        status: 200,\r\n        headers: {\r\n          'Content-Type': 'text/event-stream',\r\n          'Cache-Control': 'no-cache',\r\n          'Connection': 'keep-alive',\r\n        },\r\n      });\r\n    }\r\n\r\n    // Non-streaming fallback\r\n    const data: unknown = await upstream.json();\r\n    return Response.json(data);\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : String(err);\r\n    const isTimeout = err instanceof Error && err.name === 'AbortError';\r\n    const status = isTimeout ? 504 : 500;\r\n    const error = isTimeout ? 'Mistral request timed out after 120 seconds' : message;\r\n    console.error(`[api/mistral/chat] Unhandled: ${message}`);\r\n    return Response.json({ error }, { status });\r\n  }\r\n}\r\n\r\n// --- GitHub App OAuth auto-connect ---\r\n\r\nasync function handleGitHubAppOAuth(request: Request, env: Env): Promise<Response> {\r\n  const requestUrl = new URL(request.url);\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  if (!env.GITHUB_APP_CLIENT_ID || !env.GITHUB_APP_CLIENT_SECRET) {\r\n    return Response.json({ error: 'GitHub App OAuth not configured' }, { status: 500 });\r\n  }\r\n\r\n  if (!env.GITHUB_APP_ID || !env.GITHUB_APP_PRIVATE_KEY) {\r\n    return Response.json({ error: 'GitHub App not configured (needed for installation token)' }, { status: 500 });\r\n  }\r\n\r\n  const bodyResult = await readBodyText(request, 4096);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  let payload: { code?: string };\r\n  try {\r\n    payload = JSON.parse(bodyResult.text);\r\n  } catch {\r\n    return Response.json({ error: 'Invalid JSON' }, { status: 400 });\r\n  }\r\n\r\n  const code = payload.code;\r\n  if (!code || typeof code !== 'string') {\r\n    return Response.json({ error: 'Missing code' }, { status: 400 });\r\n  }\r\n\r\n  try {\r\n    // Step 1: Exchange OAuth code for user access token\r\n    const tokenRes = await fetch('https://github.com/login/oauth/access_token', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Accept': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        client_id: env.GITHUB_APP_CLIENT_ID,\r\n        client_secret: env.GITHUB_APP_CLIENT_SECRET,\r\n        code,\r\n      }),\r\n    });\r\n\r\n    if (!tokenRes.ok) {\r\n      const errBody = await tokenRes.text().catch(() => '');\r\n      console.error('[github/app-oauth] Token exchange failed:', tokenRes.status, errBody.slice(0, 300));\r\n      return Response.json({ error: `GitHub OAuth token exchange failed (${tokenRes.status})` }, { status: 502 });\r\n    }\r\n\r\n    const tokenData = await tokenRes.json() as { access_token?: string; error?: string; error_description?: string };\r\n    if (tokenData.error || !tokenData.access_token) {\r\n      console.error('[github/app-oauth] OAuth error:', tokenData.error, tokenData.error_description);\r\n      return Response.json({\r\n        error: tokenData.error_description || tokenData.error || 'OAuth token exchange failed',\r\n      }, { status: 400 });\r\n    }\r\n\r\n    const userToken = tokenData.access_token;\r\n\r\n    // Step 2: Find user's installations for this app\r\n    const installRes = await fetch('https://api.github.com/user/installations', {\r\n      headers: {\r\n        Authorization: `Bearer ${userToken}`,\r\n        Accept: 'application/vnd.github+json',\r\n        'X-GitHub-Api-Version': '2022-11-28',\r\n        'User-Agent': 'Push-App/1.0.0',\r\n      },\r\n    });\r\n\r\n    if (!installRes.ok) {\r\n      const errBody = await installRes.text().catch(() => '');\r\n      console.error('[github/app-oauth] Installations fetch failed:', installRes.status, errBody.slice(0, 300));\r\n      return Response.json({ error: `Failed to fetch installations (${installRes.status})` }, { status: 502 });\r\n    }\r\n\r\n    const installData = await installRes.json() as {\r\n      total_count: number;\r\n      installations: Array<{ id: number; app_id: number; app_slug: string }>;\r\n    };\r\n\r\n    // Find installation matching our app\r\n    const appId = Number(env.GITHUB_APP_ID);\r\n    const installation = installData.installations.find((inst) => inst.app_id === appId);\r\n\r\n    if (!installation) {\r\n      return Response.json({\r\n        error: 'No installation found',\r\n        details: 'You have not installed the Push Auth GitHub App. Please install it first, then try connecting again.',\r\n        install_url: `https://github.com/apps/push-auth/installations/new`,\r\n      }, { status: 404 });\r\n    }\r\n\r\n    const installationId = String(installation.id);\r\n\r\n    // Step 3: Check allowlist (if configured)\r\n    const allowedInstallationIds = (env.GITHUB_ALLOWED_INSTALLATION_IDS || '')\r\n      .split(',')\r\n      .map((id) => id.trim())\r\n      .filter(Boolean);\r\n    if (allowedInstallationIds.length > 0 && !allowedInstallationIds.includes(installationId)) {\r\n      return Response.json({ error: 'installation_id is not allowed' }, { status: 403 });\r\n    }\r\n\r\n    // Step 4: Exchange for installation token (reuses existing JWT flow)\r\n    const jwt = await generateGitHubAppJWT(env.GITHUB_APP_ID, env.GITHUB_APP_PRIVATE_KEY);\r\n    const instTokenData = await exchangeForInstallationToken(jwt, installationId);\r\n\r\n    return Response.json({\r\n      token: instTokenData.token,\r\n      expires_at: instTokenData.expires_at,\r\n      installation_id: installationId,\r\n    });\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : 'Unknown error';\r\n    console.error('[github/app-oauth] Error:', message);\r\n    return Response.json({ error: `GitHub App OAuth failed: ${message}` }, { status: 500 });\r\n  }\r\n}\r\n\r\n// --- GitHub App token exchange ---\r\n\r\nasync function handleGitHubAppToken(request: Request, env: Env): Promise<Response> {\r\n  const requestUrl = new URL(request.url);\r\n  const originCheck = validateOrigin(request, requestUrl, env);\r\n  if (!originCheck.ok) {\r\n    return Response.json({ error: originCheck.error }, { status: 403 });\r\n  }\r\n\r\n  if (!env.GITHUB_APP_ID || !env.GITHUB_APP_PRIVATE_KEY) {\r\n    return Response.json({ error: 'GitHub App not configured' }, { status: 500 });\r\n  }\r\n\r\n  const bodyResult = await readBodyText(request, 4096);\r\n  if (!bodyResult.ok) {\r\n    return Response.json({ error: bodyResult.error }, { status: bodyResult.status });\r\n  }\r\n\r\n  let payload: { installation_id?: string };\r\n  try {\r\n    payload = JSON.parse(bodyResult.text);\r\n  } catch {\r\n    return Response.json({ error: 'Invalid JSON' }, { status: 400 });\r\n  }\r\n\r\n  const installationId = payload.installation_id;\r\n  if (!installationId || typeof installationId !== 'string') {\r\n    return Response.json({ error: 'Missing installation_id' }, { status: 400 });\r\n  }\r\n\r\n  // Validate installation_id is a positive integer\r\n  if (!/^\\d+$/.test(installationId)) {\r\n    return Response.json({ error: 'Invalid installation_id format' }, { status: 400 });\r\n  }\r\n\r\n  // Prevent overly long IDs (DoS protection)\r\n  if (installationId.length > 20) {\r\n    return Response.json({ error: 'installation_id too long' }, { status: 400 });\r\n  }\r\n\r\n  const allowedInstallationIds = (env.GITHUB_ALLOWED_INSTALLATION_IDS || '')\r\n    .split(',')\r\n    .map((id) => id.trim())\r\n    .filter(Boolean);\r\n  if (allowedInstallationIds.length > 0 && !allowedInstallationIds.includes(installationId)) {\r\n    return Response.json({ error: 'installation_id is not allowed' }, { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const jwt = await generateGitHubAppJWT(env.GITHUB_APP_ID, env.GITHUB_APP_PRIVATE_KEY);\r\n    const tokenData = await exchangeForInstallationToken(jwt, installationId);\r\n    return Response.json(tokenData);\r\n  } catch (err) {\r\n    const message = err instanceof Error ? err.message : 'Unknown error';\r\n    console.error('[github/app-token] Error:', message);\r\n    return Response.json({ error: `GitHub App authentication failed: ${message}` }, { status: 500 });\r\n  }\r\n}\r\n\r\nasync function generateGitHubAppJWT(appId: string, privateKeyPEM: string): Promise<string> {\r\n  const now = Math.floor(Date.now() / 1000);\r\n  const payload = { iat: now - 60, exp: now + 600, iss: appId };\r\n\r\n  const encodeBase64Url = (data: string | Uint8Array): string => {\r\n    let base64: string;\r\n    if (typeof data === 'string') {\r\n      base64 = btoa(data);\r\n    } else {\r\n      const bytes = Array.from(data, (b) => String.fromCharCode(b)).join('');\r\n      base64 = btoa(bytes);\r\n    }\r\n    return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\r\n  };\r\n\r\n  const header = { alg: 'RS256', typ: 'JWT' };\r\n  const encodedHeader = encodeBase64Url(JSON.stringify(header));\r\n  const encodedPayload = encodeBase64Url(JSON.stringify(payload));\r\n  const signingInput = `${encodedHeader}.${encodedPayload}`;\r\n\r\n  // Normalize PEM: dotenv may store literal \\n or truncate multiline values.\r\n  // Also handle both PKCS#1 (BEGIN RSA PRIVATE KEY) and PKCS#8 (BEGIN PRIVATE KEY).\r\n  // The production Cloudflare runtime accepts PKCS#1 via importKey('pkcs8'),\r\n  // but the local workerd dev runtime does not \u2014 so we wrap PKCS#1 in PKCS#8.\r\n  const normalizedPEM = privateKeyPEM.replace(/\\\\n/g, '\\n');\r\n  const isPkcs1 = normalizedPEM.includes('BEGIN RSA PRIVATE KEY');\r\n  const pemHeader = isPkcs1 ? '-----BEGIN RSA PRIVATE KEY-----' : '-----BEGIN PRIVATE KEY-----';\r\n  const pemFooter = isPkcs1 ? '-----END RSA PRIVATE KEY-----' : '-----END PRIVATE KEY-----';\r\n  const pemContents = normalizedPEM\r\n    .replace(pemHeader, '')\r\n    .replace(pemFooter, '')\r\n    .replace(/\\s/g, '');\r\n\r\n  if (!pemContents || pemContents.length < 100) {\r\n    throw new Error(\r\n      `Private key appears empty or truncated (${pemContents.length} base64 chars). ` +\r\n      'If using .dev.vars, wrap the PEM value in double quotes for multiline support.'\r\n    );\r\n  }\r\n\r\n  const derBytes = Uint8Array.from(atob(pemContents), (c) => c.charCodeAt(0));\r\n  const pkcs8Bytes = isPkcs1 ? wrapPkcs1InPkcs8(derBytes) : derBytes;\r\n\r\n  const cryptoKey = await crypto.subtle.importKey(\r\n    'pkcs8',\r\n    pkcs8Bytes.buffer,\r\n    { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' },\r\n    false,\r\n    ['sign']\r\n  );\r\n\r\n  const signature = await crypto.subtle.sign(\r\n    'RSASSA-PKCS1-v1_5',\r\n    cryptoKey,\r\n    new TextEncoder().encode(signingInput)\r\n  );\r\n\r\n  return `${signingInput}.${encodeBase64Url(new Uint8Array(signature))}`;\r\n}\r\n\r\n/** Wrap a PKCS#1 RSA private key in a PKCS#8 ASN.1 envelope */\r\nfunction wrapPkcs1InPkcs8(pkcs1Der: Uint8Array): Uint8Array {\r\n  // PKCS#8 structure:\r\n  //   SEQUENCE {\r\n  //     INTEGER 0 (version),\r\n  //     SEQUENCE { OID 1.2.840.113549.1.1.1 (rsaEncryption), NULL },\r\n  //     OCTET STRING { <PKCS#1 DER bytes> }\r\n  //   }\r\n  function asn1Length(len: number): Uint8Array {\r\n    if (len < 0x80) return new Uint8Array([len]);\r\n    if (len < 0x100) return new Uint8Array([0x81, len]);\r\n    return new Uint8Array([0x82, (len >> 8) & 0xff, len & 0xff]);\r\n  }\r\n\r\n  const version = new Uint8Array([0x02, 0x01, 0x00]);\r\n  const rsaOid = new Uint8Array([\r\n    0x30, 0x0d, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,\r\n    0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00,\r\n  ]);\r\n  const octetTag = new Uint8Array([0x04]);\r\n  const octetLen = asn1Length(pkcs1Der.length);\r\n\r\n  const innerLen = version.length + rsaOid.length + octetTag.length + octetLen.length + pkcs1Der.length;\r\n  const seqTag = new Uint8Array([0x30]);\r\n  const seqLen = asn1Length(innerLen);\r\n\r\n  const result = new Uint8Array(seqTag.length + seqLen.length + innerLen);\r\n  let off = 0;\r\n  for (const part of [seqTag, seqLen, version, rsaOid, octetTag, octetLen, pkcs1Der]) {\r\n    result.set(part, off);\r\n    off += part.length;\r\n  }\r\n  return result;\r\n}\r\n\r\nasync function exchangeForInstallationToken(\r\n  jwt: string,\r\n  installationId: string\r\n): Promise<{ token: string; expires_at: string }> {\r\n  const response = await fetch(\r\n    `https://api.github.com/app/installations/${encodeURIComponent(installationId)}/access_tokens`,\r\n    {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: `Bearer ${jwt}`,\r\n        Accept: 'application/vnd.github+json',\r\n        'X-GitHub-Api-Version': '2022-11-28',\r\n        'User-Agent': 'Push-App/1.0.0',\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    const error = await response.text();\r\n    throw new Error(`GitHub API ${response.status}: ${error}`);\r\n  }\r\n\r\n  return await response.json() as { token: string; expires_at: string };\r\n}\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\dev\\\\Push\\\\app\\\\worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\ishaw\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\ishaw\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\dev\\\\Push\\\\app\\\\worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\dev\\\\Push\\\\.wrangler\\\\tmp\\\\bundle-1IxSH4\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\ishaw\\\\AppData\\\\Local\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\dev\\\\Push\\\\.wrangler\\\\tmp\\\\bundle-1IxSH4\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\dev\\\\Push\\\\.wrangler\\\\tmp\\\\bundle-1IxSH4\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
